import{r as c,g as U,j as r,F as z,a as t,h as O,i as Q,u as q,k as H}from"./index-44fa87b3.js";import{u as K}from"./useFormValues-238a4650.js";import{u as V}from"./useFetch-17dba94a.js";import{R as W,I as X,u as Y,E as o,C as Z,a as k,b as ee}from"./useFindMyLocation-bf3f526c.js";import{S as te}from"./sidebar.component-2468bdba.js";import{E as R,C as ae,M as se}from"./map-f0bd8d67.js";import{u as ie}from"./esm-6a195fba.js";import"./useDispatch-e871a8d4.js";import"./iconBase-4a5c86f9.js";import"./ERoles.enum-3d17fc4b.js";function T({values:d,handleChangeInput:x,handleChangeCheckbox:b,handleChangeRadio:v,showMap:h,data:G}){const{callEndpoint:n,error:S}=V(),[w,C]=c.useState((d==null?void 0:d.experience)||0),[y,j]=c.useState((d==null?void 0:d.priceByDay)||2e3),[_,i]=c.useState(Number((d==null?void 0:d.range_distance)||1300)),[p,$]=c.useState([]),D=s=>{C(parseInt(s.currentTarget.value))},F=s=>{j(parseInt(s.currentTarget.value))},g=s=>{i(parseInt(s.currentTarget.value))};return c.useEffect(()=>{p.length||n(U(O.list_subcategories)).then(({response:s})=>{s!=null&&s.data&&$(s.data)}).catch(s=>console.log(s))},[]),r(z,{children:[r("div",{children:[r("div",{children:[r("h5",{className:"font-bold text-sm md:text-base text-text-100 mb-4",children:["Precio por día (hasta ",y===2e3?"+":"",y," €)"]}),t(R,{data:{min:125,max:2e3,value:`${y}`,symbol:"€",name:"priceByDay",symbolPosition:"right"},handleChange:F,onMouseUp:x}),t("hr",{className:"separator my-9   "})]}),r("div",{className:"flex items-start",children:[r("h5",{className:"font-bold text-sm md:text-base text-text-100 mb-4",children:["Distancia (",`${_===1300?"+":""}`,_,"km)"]}),h&&t("button",{className:"flex cursor-default ml-auto mr-[1px] w-fit relative lg:cursor-pointer hover:opacity-70",onClick:h,children:t("img",{src:"/assets/icons/gps-icon.svg",width:17,height:17,alt:"Icono de GPS",className:"inline-block"})})]}),t(W,{data:{min:100,max:1300,value:`${_}`,symbol:"km",name:"range_distance",symbolPosition:"right"},handleChange:g,onMouseUp:x}),t("hr",{className:"separator my-9"})]}),r("div",{children:[r("h5",{className:"font-bold text-sm md:text-base text-text-100 mb-4",children:["Experiencia (desde ",w," años)"]}),t(R,{data:{min:0,max:15,value:`${w}`,symbol:"años",name:"experience",symbolPosition:"right"},handleChange:D,onMouseUp:x}),t("hr",{className:"separator my-9   "})]}),p==null?void 0:p.map(s=>{var N,E,L,I;return!(s!=null&&s.name)||!((N=s==null?void 0:s.subcategories)!=null&&N.length)?null:r("div",{children:[r("h5",{className:"font-bold text-sm md:text-base  text-text-100 mb-4",children:[(E=s==null?void 0:s.name)==null?void 0:E.charAt(0).toUpperCase(),(L=s==null?void 0:s.name)==null?void 0:L.slice(1)]}),(I=s==null?void 0:s.subcategories)==null?void 0:I.map((u,M)=>{var B;return t(ae,{data:{checked:(B=d.subcategories)==null?void 0:B.includes(u._id),name:u.name,label:u.name,id:u._id},handleChange:()=>b("subcategories",u._id)},u._id)}),t("hr",{className:"separator my-9   "})]})})]})}function ge(){var P;const d=Q(),x=c.useRef(null),[b,v]=c.useState(new X),{location:h,setLocation:G}=ie(void 0,x),[n,S]=c.useState(),{location:w}=Y(),[C,y]=c.useState(""),[j,_]=c.useState(!1);c.useState(!1);const{values:i,setValues:p,handleChangeInput:$,handleChangeCheckbox:D,handleChangeRadio:F}=K(new ee("1500","1300")),[g,s]=c.useState([]),{general:N}=q(e=>e);c.useEffect(()=>{if(localStorage.getItem("location")){const e=JSON.parse(localStorage.getItem("location")||"{}");(e==null?void 0:e.name)!==(n==null?void 0:n.name)&&S(e)}else w&&S(w)},[w]);const{callEndpoint:E,error:L}=V(),I=()=>{const e=(a,l)=>{const m=i.filters_active.includes(a);if(!(Array.isArray(l)&&m||!Array.isArray(l)&&l&&m)&&(Array.isArray(l)&&(l!=null&&l.length)||!Array.isArray(l)&&l)){p(f=>({...f,filters_active:f.filters_active.concat(a)}));return}};e(o.experience,i.experience),e(o.language,i.language),e(o.work_mode,i.work_mode),e(o.distance,i.range_distance),e(o.skill,i.skill),e(o.pricebyDay,i.priceByDay)},u=()=>{(async()=>{var f;let a=H.list_experts,l=!1;if(i.experience&&(a=`${a}${l?"&":"?"}experience=${i.experience}`,l=!0),["string","number"].includes(typeof i.priceByDay)&&(a=`${a}${l?"&":"?"}priceByDay=${i.priceByDay}`,l=!0),(f=i.subcategories)!=null&&f.length){const A=i.subcategories.join("-");a=`${a}${l?"&":"?"}subcategories_id=${A}`,l=!0}a=`${a}${l?"&":"?"}dist=${Number(i.range_distance||500)}`,l=!0,n!=null&&n.name&&(a=`${a}${l?"&":"?"}lat=${n==null?void 0:n.lat}&lng=${n==null?void 0:n.lng}`,l=!0);const{response:m}=await E(U(a));return n!=null&&n.name&&y(n==null?void 0:n.name),m})().then(a=>{a&&a.success&&s(a.data)}).catch(a=>console.log(a))};c.useEffect(()=>{const e=d;v(a=>({...a,data:{...e.filters}}))},[]),c.useEffect(()=>{if(I(),!n)return;const e=setTimeout(()=>u(),500);return()=>{clearTimeout(e)}},[i.experience,i.language,i.work_mode,i.skill,i.range_distance,n,i.subcategories,i.priceByDay]);const M=()=>v(e=>({...e,status:!b.status})),B=()=>v(e=>({...e,status:!1})),J=e=>{const a=(l,m)=>{p(f=>({...f,[l]:m,filters_active:f.filters_active.filter(A=>A!==e)}))};e===o.experience&&a("experience",0),e===o.language&&a("language",[]),e===o.work_mode&&a("work_mode",[]),e===o.distance&&a("range_distance",500),e===o.skill&&a("skill",[])};return r("main",{className:"bg-white-bg min-h-screen pb-8 lg:pt-6",children:[r("div",{className:"lg:rounded-xl  search w-full relative h-56 bg-text-70 md:h-64 grid place-items-center overflow-hidden lg:w-11/12 lg:mx-auto",children:[t("img",{src:"/assets/images/bg-find-experts.jpg",width:1e3,height:400,alt:"bg icon",className:"object-cover object-center h-full w-full max-h-[400px]"}),r("form",{className:"search-bar h-fit w-11/12 absolute z-20 flex flex-wrap gap-2 justify-center",onSubmit:e=>{var a;e.preventDefault(),(a=h==null?void 0:h.name)!=null&&a.length&&(S(h),localStorage.setItem("location",JSON.stringify(h)))},children:[t("input",{className:"rounded-[30px] w-full md:w-64 lg:w-96 py-2 px-5 border-[1px] text-md border-text-50 outline-none focus:border-primary focus:shadow-input transition-all ease-linear duration-300",ref:x,name:"search",type:"text",placeholder:(n==null?void 0:n.name)||"Buscar por ubicación..."}),t("div",{className:"search-icon w-full  md:w-[150px] lg:w-[256px]",children:t("button",{className:"w-full bg-secondary text-white block rounded-[30px] px-4 py-2 hover:bg-secondary-hover",type:"submit",children:"Buscar"})})]}),t("div",{className:"overlay  w-full absolute z-10 inset-0 h-full bg-text-90 opacity-50"})]}),t("div",{className:"filters relative my-6 px-4 md:px-8 lg:px-8",children:r("div",{className:"lg:w-11/12 lg:mx-auto",children:[r("div",{className:"filter-active flex gap-4 items-center flex-wrap",children:[t("span",{children:"Filtros: "}),(P=i.filters_active)!=null&&P.length?t("div",{className:"content-active-filter flex w-auto gap-4 flex-wrap",children:i.filters_active.map(e=>r("div",{className:"status rounded-sm bg-text-30 shadow-strong w-fit flex items-center gap-3 px-5 py-1",children:[t("span",{className:"block text-center text-text-80 text-sm  font-bold",children:e}),![o.distance,o.experience,o.pricebyDay].includes(e)&&t("button",{onClick:()=>J(e),children:t("img",{src:"/assets/icons/close-icon.svg",width:15,height:15,alt:"delete icon",className:"object-cover object-center h-full w-full o"})})]},e))}):t("span",{className:"text-sm font-bold text-text-90",children:"Todos"})]}),t("button",{className:"fixed right-0  w-9 h-8 rounded-l-md bg-white shadow-square p-1 top-48 flex justify-center items-center cursor-default z-20 lg:hidden",onClick:M,children:t("img",{src:"/assets/icons/filter-icon.svg",width:20,height:20,alt:"Filter icon"})})]})}),r("div",{className:"flex flex-wrap lg:flex-nowrap lg:gap-8  lg:px-0 lg:w-11/12 mx-auto w-fit",children:[r("div",{className:"content-box lg:min-w-[288px] hidden lg:block h-fit sticky top-10 ",children:[t("h5",{className:"font-bold mb-6 lg:text-lg",children:"Filtro"}),t(T,{values:i,data:b.data,handleChangeInput:$,handleChangeCheckbox:D,handleChangeRadio:F,showMap:()=>_(e=>!e)})]}),r("div",{className:"w-full",children:[Boolean(C.length)&&!N.loading_page&&r("span",{className:"mb-4 px-4 md:px-0 inline-block",children:["Mostrando ",g.length," resultados ordenados por proximidad a ",t("b",{children:C}),"."]}),r("div",{className:"w-full flex h-full",children:[t("div",{className:"w-[70%] list-technician flex flex-wrap gap-7 mt-4 justify-center lg:justify-start lg:items-stretch lg:gap-4 px-4 md:px-8 lg:px-0 w-fit lg:w-full h-fit",children:N.loading_page?r(z,{children:[t(k,{}),t(k,{}),t(k,{}),t(k,{}),t(k,{})]}):g==null?void 0:g.map(e=>{var a,l,m;return t(Z,{data:{name:e.firstName+" "+e.lastName,title:((a=e==null?void 0:e.profileInfo)==null?void 0:a.title)||"",description:((l=e==null?void 0:e.profileInfo)==null?void 0:l.description)||"",picture:e.picture,price:50,location:((m=e==null?void 0:e.location)==null?void 0:m.name)||"",subcategories:e.subcategories,skills:e.skills,status:e.status,id:e._id.toString(),priceByDay:e.priceByDay,role:e.role}},e._id)})}),!N.loading_page&&j&&t("div",{className:"w-[40%] pb-8",children:t(se,{experts:g,location:n})})]})]})]}),b.status?t(te,{onClose:B,label:"Filtro",children:t(T,{values:i,data:b.data,handleChangeInput:$,handleChangeCheckbox:D,handleChangeRadio:F})}):null]})}export{ge as default};
