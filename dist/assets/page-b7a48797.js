import{r as m,g as O,j as r,F as U,a as t,h as J,i as q,u as H,k as W}from"./index-23031116.js";import{u as Y}from"./useFormValues-c51c07f2.js";import{u as V}from"./useFetch-1f74a4af.js";import{R as X,L as Z,G as ee,M as te,O as P,I as ae,u as ie,E as g,C as se,a as k,b as ne}from"./esm-4eab2069.js";import{S as le}from"./sidebar.component-b2cd561d.js";import{E as G,C as oe}from"./experienceRange.component-a575feee.js";import{u as re}from"./useGooglePlacesAutocomplete-35919cbb.js";import"./useDispatch-a52118b3.js";import"./iconBase-1978cc95.js";import"./ERoles.enum-3d17fc4b.js";function T({values:s,handleChangeInput:h,handleChangeCheckbox:c,handleChangeRadio:d,showMap:u,data:K}){const{callEndpoint:l,error:S}=V(),[N,$]=m.useState((s==null?void 0:s.experience)||0),[v,I]=m.useState((s==null?void 0:s.priceByDay)||2e3),[_,n]=m.useState(Number((s==null?void 0:s.range_distance)||1300)),[x,C]=m.useState([]),L=i=>{$(parseInt(i.currentTarget.value))},E=i=>{I(parseInt(i.currentTarget.value))},w=i=>{n(parseInt(i.currentTarget.value))};return m.useEffect(()=>{x.length||l(O(J.list_subcategories)).then(({response:i})=>{i!=null&&i.data&&C(i.data)}).catch(i=>console.log(i))},[]),r(U,{children:[r("div",{children:[r("div",{children:[r("h5",{className:"font-bold text-sm md:text-base text-text-100 mb-4",children:["Precio por día (hasta ",v===2e3?"+":"",v," €)"]}),t(G,{data:{min:125,max:2e3,value:`${v}`,symbol:"€",name:"priceByDay",symbolPosition:"right"},handleChange:E,onMouseUp:h}),t("hr",{className:"separator my-9   "})]}),r("div",{className:"flex items-start",children:[r("h5",{className:"font-bold text-sm md:text-base text-text-100 mb-4",children:["Distancia (",`${_===1300?"+":""}`,_,"km)"]}),u&&t("button",{className:"flex cursor-default ml-auto mr-[1px] w-fit relative lg:cursor-pointer hover:opacity-70",onClick:u,children:t("img",{src:"/assets/icons/gps-icon.svg",width:17,height:17,alt:"Icono de GPS",className:"inline-block"})})]}),t(X,{data:{min:100,max:1300,value:`${_}`,symbol:"km",name:"range_distance",symbolPosition:"right"},handleChange:w,onMouseUp:h}),t("hr",{className:"separator my-9"})]}),r("div",{children:[r("h5",{className:"font-bold text-sm md:text-base text-text-100 mb-4",children:["Experiencia (desde ",N," años)"]}),t(G,{data:{min:0,max:15,value:`${N}`,symbol:"años",name:"experience",symbolPosition:"right"},handleChange:L,onMouseUp:h}),t("hr",{className:"separator my-9   "})]}),x==null?void 0:x.map(i=>{var y,F,A,D;return!(i!=null&&i.name)||!((y=i==null?void 0:i.subcategories)!=null&&y.length)?null:r("div",{children:[r("h5",{className:"font-bold text-sm md:text-base  text-text-100 mb-4",children:[(F=i==null?void 0:i.name)==null?void 0:F.charAt(0).toUpperCase(),(A=i==null?void 0:i.name)==null?void 0:A.slice(1)]}),(D=i==null?void 0:i.subcategories)==null?void 0:D.map((f,j)=>{var B;return t(oe,{data:{checked:(B=s.subcategories)==null?void 0:B.includes(f._id),name:f.name,label:f.name,id:f._id},handleChange:()=>c("subcategories",f._id)},f._id)}),t("hr",{className:"separator my-9   "})]})})]})}const ce="AIzaSyBVUmBvG07m3bK6hncyCFU6bigGQRM2aOA",de=s=>{const h=s.reduce((d,u)=>d+u.location.geoLocation.coordinates[1],0)/s.length,c=s.reduce((d,u)=>d+u.location.geoLocation.coordinates[0],0)/s.length;return{lat:h,lng:c}},me=(s,h)=>{const c=h.filter(d=>d.location.geoLocation.coordinates[0]===s.location.geoLocation.coordinates[0]&&d.location.geoLocation.coordinates[1]===s.location.geoLocation.coordinates[1]);return c.length===1?`${s.firstName} ${s.lastName}`:`(${c.length}) ${c.map(d=>`${d.firstName} ${d.lastName}`).join(", ").substring(0,30)+"..."}`},z=({experts:s,location:h})=>t(ee,{mapContainerStyle:{minHeight:"400px",height:"100%",width:"100%"},center:de(s),zoom:5,children:s.map((c,d)=>r(m.Fragment,{children:[t(te,{position:{lat:c.location.geoLocation.coordinates[1],lng:c.location.geoLocation.coordinates[0]}},d),t(P,{position:{lat:c.location.geoLocation.coordinates[1],lng:c.location.geoLocation.coordinates[0]},mapPaneName:P.OVERLAY_MOUSE_TARGET,children:r("div",{className:"absolute z-10 inline-block px-3 py-2 text-sm font-medium text-gray-900 whitespace-nowrap bg-white border border-0 rounded-lg shadow-sm tooltip capitalize",children:[t("h4",{className:"font-bold mb-[1px]",children:me(c,s)}),t("span",{className:"text-xs",children:c.location.name}),t("div",{className:"tooltip-arrow","data-popper-arrow":!0})]})})]},d))}),he=({experts:s,location:h})=>window.google?t(z,{experts:s,location:h}):r(Z,{googleMapsApiKey:ce,children:[t(z,{experts:s,location:h})," "]}),ge=he;function Se(){var R;const s=q(),h=m.useRef(null),[c,d]=m.useState(new ae),{location:u,setLocation:K}=re(void 0,h),[l,S]=m.useState(),{location:N}=ie(),[$,v]=m.useState(""),[I,_]=m.useState(!1);m.useState(!1);const{values:n,setValues:x,handleChangeInput:C,handleChangeCheckbox:L,handleChangeRadio:E}=Y(new ne("1500","1300")),[w,i]=m.useState([]),{general:y}=H(e=>e);m.useEffect(()=>{if(localStorage.getItem("location")){const e=JSON.parse(localStorage.getItem("location")||"{}");(e==null?void 0:e.name)!==(l==null?void 0:l.name)&&S(e)}else N&&S(N)},[N]);const{callEndpoint:F,error:A}=V(),D=()=>{const e=(a,o)=>{const p=n.filters_active.includes(a);if(!(Array.isArray(o)&&p||!Array.isArray(o)&&o&&p)&&(Array.isArray(o)&&(o!=null&&o.length)||!Array.isArray(o)&&o)){x(b=>({...b,filters_active:b.filters_active.concat(a)}));return}};e(g.experience,n.experience),e(g.language,n.language),e(g.work_mode,n.work_mode),e(g.distance,n.range_distance),e(g.skill,n.skill),e(g.pricebyDay,n.priceByDay)},f=()=>{(async()=>{var b;let a=W.list_experts,o=!1;if(n.experience&&(a=`${a}${o?"&":"?"}experience=${n.experience}`,o=!0),["string","number"].includes(typeof n.priceByDay)&&(a=`${a}${o?"&":"?"}priceByDay=${n.priceByDay}`,o=!0),(b=n.subcategories)!=null&&b.length){const M=n.subcategories.join("-");a=`${a}${o?"&":"?"}subcategories_id=${M}`,o=!0}a=`${a}${o?"&":"?"}dist=${Number(n.range_distance||500)}`,o=!0,l!=null&&l.name&&(a=`${a}${o?"&":"?"}lat=${l==null?void 0:l.lat}&lng=${l==null?void 0:l.lng}`,o=!0);const{response:p}=await F(O(a));return l!=null&&l.name&&v(l==null?void 0:l.name),p})().then(a=>{a&&a.success&&i(a.data)}).catch(a=>console.log(a))};m.useEffect(()=>{const e=s;d(a=>({...a,data:{...e.filters}}))},[]),m.useEffect(()=>{if(D(),!l)return;const e=setTimeout(()=>f(),500);return()=>{clearTimeout(e)}},[n.experience,n.language,n.work_mode,n.skill,n.range_distance,l,n.subcategories,n.priceByDay]);const j=()=>d(e=>({...e,status:!c.status})),B=()=>d(e=>({...e,status:!1})),Q=e=>{const a=(o,p)=>{x(b=>({...b,[o]:p,filters_active:b.filters_active.filter(M=>M!==e)}))};e===g.experience&&a("experience",0),e===g.language&&a("language",[]),e===g.work_mode&&a("work_mode",[]),e===g.distance&&a("range_distance",500),e===g.skill&&a("skill",[])};return r("main",{className:"bg-white-bg min-h-screen pb-8 lg:pt-6",children:[r("div",{className:"lg:rounded-xl  search w-full relative h-56 bg-text-70 md:h-64 grid place-items-center overflow-hidden lg:w-11/12 lg:mx-auto",children:[t("img",{src:"/assets/images/bg-find-experts.jpg",width:1e3,height:400,alt:"bg icon",className:"object-cover object-center h-full w-full max-h-[400px]"}),r("form",{className:"search-bar h-fit w-11/12 absolute z-20 flex flex-wrap gap-2 justify-center",onSubmit:e=>{var a;e.preventDefault(),(a=u==null?void 0:u.name)!=null&&a.length&&(S(u),localStorage.setItem("location",JSON.stringify(u)))},children:[t("input",{className:"rounded-[30px] w-full md:w-64 lg:w-96 py-2 px-5 border-[1px] text-md border-text-50 outline-none focus:border-primary focus:shadow-input transition-all ease-linear duration-300",ref:h,name:"search",type:"text",placeholder:(l==null?void 0:l.name)||"Buscar por ubicación..."}),t("div",{className:"search-icon w-full  md:w-[150px] lg:w-[256px]",children:t("button",{className:"w-full bg-secondary text-white block rounded-[30px] px-4 py-2 hover:bg-secondary-hover",type:"submit",children:"Buscar"})})]}),t("div",{className:"overlay  w-full absolute z-10 inset-0 h-full bg-text-90 opacity-50"})]}),t("div",{className:"filters relative my-6 px-4 md:px-8 lg:px-8",children:r("div",{className:"lg:w-11/12 lg:mx-auto",children:[r("div",{className:"filter-active flex gap-4 items-center flex-wrap",children:[t("span",{children:"Filtros: "}),(R=n.filters_active)!=null&&R.length?t("div",{className:"content-active-filter flex w-auto gap-4 flex-wrap",children:n.filters_active.map(e=>r("div",{className:"status rounded-sm bg-text-30 shadow-strong w-fit flex items-center gap-3 px-5 py-1",children:[t("span",{className:"block text-center text-text-80 text-sm  font-bold",children:e}),![g.distance,g.experience,g.pricebyDay].includes(e)&&t("button",{onClick:()=>Q(e),children:t("img",{src:"/assets/icons/close-icon.svg",width:15,height:15,alt:"delete icon",className:"object-cover object-center h-full w-full o"})})]},e))}):t("span",{className:"text-sm font-bold text-text-90",children:"Todos"})]}),t("button",{className:"fixed right-0  w-9 h-8 rounded-l-md bg-white shadow-square p-1 top-48 flex justify-center items-center cursor-default z-20 lg:hidden",onClick:j,children:t("img",{src:"/assets/icons/filter-icon.svg",width:20,height:20,alt:"Filter icon"})})]})}),r("div",{className:"flex flex-wrap lg:flex-nowrap lg:gap-8  lg:px-0 lg:w-11/12 mx-auto w-fit",children:[r("div",{className:"content-box lg:min-w-[288px] hidden lg:block h-fit sticky top-10 ",children:[t("h5",{className:"font-bold mb-6 lg:text-lg",children:"Filtro"}),t(T,{values:n,data:c.data,handleChangeInput:C,handleChangeCheckbox:L,handleChangeRadio:E,showMap:()=>_(e=>!e)})]}),r("div",{className:"w-full",children:[Boolean($.length)&&!y.loading_page&&r("span",{className:"mb-4 px-4 md:px-0 inline-block",children:["Mostrando ",w.length," resultados ordenados por proximidad a ",t("b",{children:$}),"."]}),r("div",{className:"w-full flex h-full",children:[t("div",{className:"w-[70%] list-technician flex flex-wrap gap-7 mt-4 justify-center lg:justify-start lg:items-stretch lg:gap-4 px-4 md:px-8 lg:px-0 w-fit lg:w-full h-fit",children:y.loading_page?r(U,{children:[t(k,{}),t(k,{}),t(k,{}),t(k,{}),t(k,{})]}):w==null?void 0:w.map(e=>{var a,o,p;return t(se,{data:{name:e.firstName+" "+e.lastName,title:((a=e==null?void 0:e.profileInfo)==null?void 0:a.title)||"",description:((o=e==null?void 0:e.profileInfo)==null?void 0:o.description)||"",picture:e.picture,price:50,location:((p=e==null?void 0:e.location)==null?void 0:p.name)||"",subcategories:e.subcategories,skills:e.skills,status:e.status,id:e._id.toString(),priceByDay:e.priceByDay,role:e.role}},e._id)})}),!y.loading_page&&I&&t("div",{className:"w-[40%] pb-8",children:t(ge,{experts:w,location:l})})]})]})]}),c.status?t(le,{onClose:B,label:"Filtro",children:t(T,{values:n,data:c.data,handleChangeInput:C,handleChangeCheckbox:L,handleChangeRadio:E})}):null]})}export{Se as default};
