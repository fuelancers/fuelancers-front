import{r as d,g as M,a as t,F as D,j as c,h as J,i as Q,u as Y,k as q}from"./index-3db8ba88.js";import{u as K}from"./useFormValues-36257fb6.js";import{u as R}from"./useFetch-6f7c80d5.js";import{R as U,I as W,u as X,E as h,C as Z,a as w,b as ee}from"./useFindMyLocation-8441a6db.js";import{S as te}from"./sidebar.component-15d07753.js";import{L as ae,G as ie,M as se,O as A,u as ne}from"./esm-c88d6ba3.js";import"./useDispatch-1d77a426.js";import"./iconBase-01a3840a.js";import"./ERoles.enum-3d17fc4b.js";function I({values:n,handleChangeInput:g,handleChangeCheckbox:l,handleChangeRadio:r,showMap:m,data:z}){const{callEndpoint:s,error:x}=R();d.useState((n==null?void 0:n.experience)||0);const[p,N]=d.useState(Number((n==null?void 0:n.range_distance)||1300)),[y,S]=d.useState([]),k=i=>{N(parseInt(i.currentTarget.value))};return d.useEffect(()=>{y.length||s(M(J.list_subcategories)).then(({response:i})=>{i!=null&&i.data&&S(i.data)}).catch(i=>console.log(i))},[]),t(D,{children:c("div",{children:[c("div",{className:"flex items-start",children:[c("h5",{className:"font-bold text-sm md:text-base text-text-100 mb-4",children:["Distancia (",p,"km)"]}),m&&t("button",{className:"flex cursor-default ml-auto mr-[1px] w-fit relative lg:cursor-pointer hover:opacity-70",onClick:m,children:t("img",{src:"/assets/icons/gps-icon.svg",width:17,height:17,alt:"Icono de GPS",className:"inline-block"})})]}),t(U,{data:{min:100,max:1300,value:`${p}`,symbol:"km",name:"range_distance",symbolPosition:"right"},handleChange:k,onMouseUp:g})]})})}const oe="AIzaSyC6QltOHAmNrlE1ABY9--1PyYqCJjH9-m0",le=n=>{const g=n.reduce((r,m)=>r+m.location.geoLocation.coordinates[1],0)/n.length,l=n.reduce((r,m)=>r+m.location.geoLocation.coordinates[0],0)/n.length;return{lat:g,lng:l}},ce=(n,g)=>{const l=g.filter(r=>r.location.geoLocation.coordinates[0]===n.location.geoLocation.coordinates[0]&&r.location.geoLocation.coordinates[1]===n.location.geoLocation.coordinates[1]);return l.length===1?`${n.firstName} ${n.lastName}`:`(${l.length}) ${l.map(r=>`${r.firstName} ${r.lastName}`).join(", ").substring(0,30)+"..."}`},j=({experts:n,location:g})=>t(ie,{mapContainerStyle:{minHeight:"400px",height:"100%",width:"100%"},center:le(n),zoom:5,children:n.map((l,r)=>c(d.Fragment,{children:[t(se,{position:{lat:l.location.geoLocation.coordinates[1],lng:l.location.geoLocation.coordinates[0]}},r),t(A,{position:{lat:l.location.geoLocation.coordinates[1],lng:l.location.geoLocation.coordinates[0]},mapPaneName:A.OVERLAY_MOUSE_TARGET,children:c("div",{className:"absolute z-10 inline-block px-3 py-2 text-sm font-medium text-gray-900 whitespace-nowrap bg-white border border-0 rounded-lg shadow-sm tooltip capitalize",children:[t("h4",{className:"font-bold mb-[1px]",children:ce(l,n)}),t("span",{className:"text-xs",children:l.location.name}),t("div",{className:"tooltip-arrow","data-popper-arrow":!0})]})})]},r))}),re=({experts:n,location:g})=>window.google?t(j,{experts:n,location:g}):c(ae,{googleMapsApiKey:oe,children:[t(j,{experts:n,location:g})," "]}),de=re;function Se(){var E;const n=Q(),g=d.useRef(null),[l,r]=d.useState(new W),{location:m,setLocation:z}=ne(void 0,g),[s,x]=d.useState(),{location:p}=X(),[N,y]=d.useState(""),[S,k]=d.useState(!1);d.useState(!1);const{values:i,setValues:L,handleChangeInput:C,handleChangeCheckbox:$,handleChangeRadio:F}=K(new ee("1500","1300")),[b,O]=d.useState([]),{general:v}=Y(e=>e);d.useEffect(()=>{if(localStorage.getItem("location")){const e=JSON.parse(localStorage.getItem("location")||"{}");(e==null?void 0:e.name)!==(s==null?void 0:s.name)&&x(e)}else p&&x(p)},[p]);const{callEndpoint:B,error:ge}=R(),G=()=>{const e=(a,o)=>{const u=i.filters_active.includes(a);if(!(Array.isArray(o)&&u||!Array.isArray(o)&&o&&u)&&(Array.isArray(o)&&(o!=null&&o.length)||!Array.isArray(o)&&o)){L(f=>({...f,filters_active:f.filters_active.concat(a)}));return}};e(h.experience,i.experience),e(h.language,i.language),e(h.work_mode,i.work_mode),e(h.distance,i.range_distance),e(h.skill,i.skill)},T=()=>{(async()=>{var f;let a=q.list_clinics,o=!0;if(i.experience&&(a=`${a}${o?"&":"?"}experience=${i.experience}`,o=!0),(f=i.subcategories)!=null&&f.length){const _=i.subcategories.join("-");a=`${a}${o?"&":"?"}subcategories_id=${_}`,o=!0}a=`${a}${o?"&":"?"}dist=${Number(i.range_distance||500)}`,o=!0,s!=null&&s.name&&(a=`${a}${o?"&":"?"}lat=${s==null?void 0:s.lat}&lng=${s==null?void 0:s.lng}`,o=!0);const{response:u}=await B(M(a));return s!=null&&s.name&&y(s==null?void 0:s.name),u})().then(a=>{a&&a.success&&O(a.data)}).catch(a=>console.log(a))};d.useEffect(()=>{const e=n;r(a=>({...a,data:{...e.filters}}))},[]),d.useEffect(()=>{if(G(),!s)return;const e=setTimeout(()=>T(),500);return()=>{clearTimeout(e)}},[i.experience,i.language,i.work_mode,i.skill,i.range_distance,s,i.subcategories]);const P=()=>r(e=>({...e,status:!l.status})),V=()=>r(e=>({...e,status:!1})),H=e=>{const a=(o,u)=>{L(f=>({...f,[o]:u,filters_active:f.filters_active.filter(_=>_!==e)}))};e===h.experience&&a("experience",0),e===h.language&&a("language",[]),e===h.work_mode&&a("work_mode",[]),e===h.distance&&a("range_distance",500),e===h.skill&&a("skill",[])};return c("main",{className:"bg-white-bg min-h-screen pb-8 lg:pt-6",children:[c("div",{className:"lg:rounded-xl  search w-full relative h-56 bg-text-70 md:h-64 grid place-items-center overflow-hidden lg:w-11/12 lg:mx-auto",children:[t("img",{src:"/assets/images/bg-find-experts.jpg",width:1e3,height:400,alt:"bg icon",className:"object-cover object-center h-full w-full max-h-[400px]"}),c("form",{className:"search-bar h-fit w-11/12 absolute z-20 flex flex-wrap gap-2 justify-center",onSubmit:e=>{var a;e.preventDefault(),(a=m==null?void 0:m.name)!=null&&a.length&&(x(m),localStorage.setItem("location",JSON.stringify(m)))},children:[t("input",{className:"rounded-[30px] w-full md:w-64 lg:w-96 py-2 px-5 border-[1px] text-md border-text-50 outline-none focus:border-primary focus:shadow-input transition-all ease-linear duration-300",ref:g,name:"search",type:"text",placeholder:(s==null?void 0:s.name)||"Buscar por ubicaciÃ³n..."}),t("div",{className:"search-icon w-full  md:w-[150px] lg:w-[256px]",children:t("button",{className:"w-full bg-secondary text-white block rounded-[30px] px-4 py-2 hover:bg-secondary-hover",type:"submit",children:"Buscar"})})]}),t("div",{className:"overlay  w-full absolute z-10 inset-0 h-full bg-text-90 opacity-50"})]}),t("div",{className:"filters relative my-6 px-4 md:px-8 lg:px-8",children:c("div",{className:"lg:w-11/12 lg:mx-auto",children:[c("div",{className:"filter-active flex gap-4 items-center flex-wrap",children:[t("span",{children:"Filtros: "}),(E=i.filters_active)!=null&&E.length?t("div",{className:"content-active-filter flex w-auto gap-4 flex-wrap",children:i.filters_active.map(e=>c("div",{className:"status rounded-sm bg-text-30 shadow-strong w-fit flex items-center gap-3 px-5 py-1",children:[t("span",{className:"block text-center text-text-80 text-sm  font-bold",children:e}),e!==h.distance&&e!==h.experience&&t("button",{onClick:()=>H(e),children:t("img",{src:"/assets/icons/close-icon.svg",width:15,height:15,alt:"delete icon",className:"object-cover object-center h-full w-full o"})})]},e))}):t("span",{className:"text-sm font-bold text-text-90",children:"Todos"})]}),t("button",{className:"fixed right-0  w-9 h-8 rounded-l-md bg-white shadow-square p-1 top-48 flex justify-center items-center cursor-default z-20 lg:hidden",onClick:P,children:t("img",{src:"/assets/icons/filter-icon.svg",width:20,height:20,alt:"Filter icon"})})]})}),c("div",{className:"flex flex-wrap lg:flex-nowrap lg:gap-8  lg:px-0 lg:w-11/12 mx-auto w-fit",children:[c("div",{className:"content-box lg:min-w-[288px] hidden lg:block h-fit sticky top-10 ",children:[t("h5",{className:"font-bold mb-6 lg:text-lg",children:"Filtro"}),t(I,{values:i,data:l.data,handleChangeInput:C,handleChangeCheckbox:$,handleChangeRadio:F,showMap:()=>k(e=>!e)})]}),c("div",{className:"w-full",children:[Boolean(N.length)&&!v.loading_page&&c("span",{className:"mb-4 px-4 md:px-0 inline-block",children:["Mostrando ",b.length," resultados ordenados por proximidad a ",t("b",{children:N}),"."]}),c("div",{className:"w-full flex h-full",children:[t("div",{className:"w-[70%] list-technician flex flex-wrap gap-7 mt-4 justify-center lg:justify-start lg:items-stretch lg:gap-4 px-4 md:px-8 lg:px-0 w-fit lg:w-full h-fit",children:v.loading_page?c(D,{children:[t(w,{}),t(w,{}),t(w,{}),t(w,{}),t(w,{})]}):b==null?void 0:b.map(e=>{var a,o,u;return t(Z,{data:{name:e.firstName+" "+e.lastName,title:((a=e==null?void 0:e.profileInfo)==null?void 0:a.title)||"",description:((o=e==null?void 0:e.profileInfo)==null?void 0:o.description)||"",picture:e.picture,price:50,location:((u=e==null?void 0:e.location)==null?void 0:u.name)||"",subcategories:e.subcategories,skills:e.skills,status:e.status,id:e._id.toString(),priceByDay:e.priceByDay,role:e.role}},e._id)})}),!v.loading_page&&S&&t("div",{className:"w-[40%] pb-8",children:t(de,{experts:b,location:s})})]})]})]}),l.status?t(te,{onClose:V,label:"Filtro",children:t(I,{values:i,data:l.data,handleChangeInput:C,handleChangeCheckbox:$,handleChangeRadio:F})}):null]})}export{Se as default};
